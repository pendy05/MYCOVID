<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML for plotting local CSV using Chart.js</title>

    <script src="chartFunction.js"></script>
    <!--Chart.js CDN (Content Delivery Network) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!--Chart.js Date Adapter CDN (Content Delivery Network) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.js"></script
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>>-->
    <script src="css/style.css"></script>
  </head>
  <body>
    <div class="container" style="height: 30%; width: 30%">
      <canvas id="chart1" width="100" height="100"></canvas>
    </div>
    <script>
      drawLineChart();
      //const dates, johor = getData();
      async function drawLineChart(dates, state) {
        const data = await getData(
          "covid19-public-main/epidemic/cases_state.csv"
        );
        const ctx = document.getElementById("chart1").getContext("2d");
        //console.log(data.unique_dates);
        //console.log(data.johor);
        const myChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.unique_dates,
            datasets: [
              {
                label: "New cases",
                data: data.johor.cases_new,
                borderColor: "#001234",
                backgroundColor: "#001234",
              },
              {
                label: "Import Cases",
                data: data.johor.cases_import,
                borderColor: "#0c51ff",
                backgroundColor: "#0c51ff",
              },
            ],
          },
          options: {
            scales: {
              x: {
                type: "timeseries",
                time: {
                  unit: "month",
                },
                ticks: {
                  score: "data",
                },
              },
            },
            elements: {
              point: {
                radius: 0,
              },
            },

            tooltips: {
              mode: "index",
              intersect: false,
              callbacks: {
                label: (item) =>
                  item.dataset.label +
                  ": " +
                  this.originalValues[item.datasetIndex].data[item.dataIndex],
              },
            },
            hover: {
              mode: "index",
              intersect: false,
            },
          },
        });
      }

      async function getData(filename) {
        const xs = [];
        const ys = [];
        const dates = [];
        const dict = {};
        const johor = {
          cases_new: [],
          cases_import: [],
          cases_recovered: [],
          cases_active: [],
          cases_cluster: [],
          cases_unvax: [],
          cases_pvax: [],
          cases_fvax: [],
          cases_boost: [],
          cases_child: [],
          cases_adolescent: [],
          cases_adult: [],
          cases_elderly: [],
        };
        const kedah = {};

        const states_cases = await fetch(filename).then((response) =>
          response.text()
        );
        const table = states_cases.split("\n").splice(1);
        table.forEach((row) => {
          columns = row.split(",");
          dates.push(columns[0]);
          //state
          if (columns[1] == "Johor") {
            johor.cases_new.push(columns[2]);
            johor.cases_import.push(columns[3]);
            johor.cases_recovered.push(columns[4]);
            johor.cases_active.push(columns[5]);
            johor.cases_cluster.push(columns[6]);
            johor.cases_unvax.push(columns[7]);
            johor.cases_pvax.push(columns[8]);
            johor.cases_fvax.push(columns[9]);
            johor.cases_boost.push(columns[10]);
            johor.cases_child.push(columns[11]);
            johor.cases_adolescent.push(columns[12]);
            johor.cases_adult.push(columns[13]);
            johor.cases_elderly.push(columns[14]);
          } /*else if (columns[1] == "Kedah") {
              } else if (columns[1] == "Kelantan") {
              } else if (columns[1] == "Melaka") {
              } else if (columns[1] == "Negeri Sembilan") {
              } else if (columns[1] == "Pahang") {
              } else if (columns[1] == "Perak") {
              } else if (columns[1] == "Perlis") {
              } else if (columns[1] == "Pulau Pinang") {
              } else if (columns[1] == "Sabah") {
              } else if (columns[1] == "Sarawak") {
              } else if (columns[1] == "Selangor") {
              } else if (columns[1] == "Terengganu") {
              } else if (columns[1] == "W.P. Kuala Lumpur") {
              } else if (columns[1] == "W.P. Labuan") {
              } else if (columns[1] == "W.P. Putrajaya") {
              }*/
        });
        //console.log(johor);
        // remove duplicates from dates
        const unique_dates = Array.from(new Set(dates));
        //console.log(unique_dates);
        return { unique_dates, johor };
      }
    </script>
  </body>
</html>
